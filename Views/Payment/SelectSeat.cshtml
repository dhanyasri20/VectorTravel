@model TravelBookingSystem.Models.Flight
@{
    ViewData["Title"] = "Select Your Seat";
}

<style>
    body {
        background-color: #f4f5f7;
    }

    .booking-container {
        display: grid;
        grid-template-columns: 1fr 380px; 
        gap: 30px;
        align-items: flex-start;
    }

    .main-content {
        background: #fff;
        padding: 2.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }
    
    .sidebar {
        position: sticky;
        top: 20px;
    }

    .summary-card {
        background: #fff;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }

    .flight-details-header {
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
    }

    .plane {
        margin: 2rem auto;
    }
    .fuselage {
        border: 2px solid #ced4da;
        border-radius: 15px;
        position: relative;
    }
    .plane-layout {
        display: grid;
        grid-template-columns: repeat(3, 1fr) 50px repeat(3, 1fr); 
        gap: 10px;
        padding: 25px;
    }
    .seat {
        height: 38px;
        width: 38px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 7px;
        font-weight: bold;
        font-size: 12px;
    }
    .seat.available { background-color: #e9ecef; border: 1px solid #adb5bd; cursor: pointer; transition: all 0.2s; }
    .seat.available:hover { transform: scale(1.1); box-shadow: 0 0 10px rgba(13, 110, 253, 0.5); }
    .seat.occupied { background-color: #6c757d; color: white; cursor: not-allowed; }
    .seat.selected { background-color: #198754; color: white; border-color: #198754; transform: scale(1.1); }

    .seat-legend { display: flex; justify-content: center; gap: 20px; margin-top: 1.5rem; }
    .legend-item { display: flex; align-items: center; gap: 8px; }
    .legend-box { width: 20px; height: 20px; border-radius: 3px; }

    .fare-details li {
        display: flex;
        justify-content: space-between;
        margin-bottom: .5rem;
    }
</style>

<div class="container my-5">
    <div class="booking-container">
        <div class="main-content">
            <div class="flight-details-header">
                <h2>Seat Selection</h2>
                <p class="lead text-muted">Choose your preferred seat for your flight.</p>
            </div>

            <div class="plane">
                <div class="fuselage">
                    <div class="plane-layout">
                        @foreach (var seat in Model.Seats.OrderBy(s => s.Id))
                        {
                            var statusClass = seat.IsAvailable ? "available" : "occupied";
                            <div class="seat @statusClass" data-seat-number="@seat.SeatNumber">
                                @seat.SeatNumber
                            </div>
                        }
                    </div>
                </div>
            </div>
             <div class="seat-legend">
                <div class="legend-item"><div class="legend-box" style="background-color: #e9ecef; border: 1px solid #adb5bd;"></div> Available</div>
                <div class="legend-item"><div class="legend-box" style="background-color: #6c757d;"></div> Occupied</div>
                <div class="legend-item"><div class="legend-box" style="background-color: #198754;"></div> Your Selection</div>
            </div>
        </div>

        <div class="sidebar">
            <div class="summary-card">
                <h4>Flight Summary</h4>
                <hr>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h5 class="mb-0">@Model.DepartureCity → @Model.ArrivalCity</h5>
                        <small class="text-muted">@Model.Airline</small>
                    </div>
                    <i class="bi bi-airplane-fill fs-2 text-primary"></i>
                </div>
                
                <ul class="list-unstyled fare-details">
                    <li><span>Base Fare</span> <strong>₹@Model.Price.ToString("N0")</strong></li>
                    <li><span>Taxes & Fees</span> <span class="text-success">Included</span></li>
                    <li><span>Selected Seat</span> <strong id="selection-text">None</strong></li>
                </ul>
                <hr>
                <div class="d-flex justify-content-between align-items-center h4">
                    <span>Total Price</span>
                    <strong>₹@Model.Price.ToString("N0")</strong>
                </div>

                <form asp-controller="Payment" asp-action="CreateOrder" method="post" class="mt-4">
                    <input type="hidden" name="flightId" value="@Model.Id" />
                    <input type="hidden" id="selectedSeat" name="selectedSeat" />
                    <button id="proceedButton" type="submit" class="btn btn-primary btn-lg w-100" disabled>
                        Confirm & Proceed to Pay
                    </button>
                </form>
            </div>
        </div> 
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.seat.available').on('click', function () {
           
                $('.seat.selected').removeClass('selected').addClass('available');
                
                $(this).removeClass('available').addClass('selected');
                
                var seatNumber = $(this).data('seat-number');
                
                $('#selectedSeat').val(seatNumber);
                
                $('#selection-text').text(seatNumber);
                
                $('#proceedButton').prop('disabled', false);
            });
        });
    </script>
} 